# 【机密】老师是怎么发现你抄代码的

免责声明：本视频不支持任何意义上的学术不端，主要目的为科普代码查重的工作原理。

大家好，欢迎来到我的视频。那么随着期末周的到来，许多小伙伴可能因为压力大时间紧的原因，有意或者无意的与别人合作了代码作业，然后被老师发现，就寄了。那么大家有没有想过，老师究竟是怎么发现大家合作代码的。有没有一些方法可以在提交作业前，先进行代码查重后降重避免惨案？那么今天一个视频就可以讲清楚，代码查重的原理以及如何降重。

在此声明，本视频不支持任何意义上的学术不端，主要目的为科普代码查重的工作原理。

那么大家都知道，对于咱们的作文或者论文，有很多平台可以进行查重，比如说turnitin。那么对于代码，有没有这样的一个平台呢？唉，还真有。这个就是来自斯坦福大名鼎鼎的MOSS：Measure Of Software Similarity。据我所知，美国绝大多数的大学都在用这个平台进行代码查重。但是与turnitin这种平台不同，MOSS只提供一个基本的两个代码之间比较，而不能搜索以及比对互联网上的其他内容。所以与我的计算机课教授深度交流后知道，一般来说每个学校的每一门课都有一个自己的数据库，里面有当届以及往届学生所有提交过的作业代码。然后在每次作业提交后，老师一般多会运行一个脚本来遍历里面所有的代码进行比对。高过阈值相似度的代码就会呈现出来，并标记为可疑，一般这种时候只要老师手动再看一遍，几乎就能判定抄袭或者合作了。

那么MOSS究竟是怎么判断两个代码的相似度的呢？MOSS问世于1994年，与现在皆然相反，那个时候机器学习以及深度学习还并未崛起。所以说MOSS完全不是一个炼丹出来的程序，而它的原理也非常简单：就是筛子算法（WINNOWING Algorithm）。在这里我们进行一个非常简单的原理科普。首先MOSS会对咱们的文本进行预处理，也就是pre clean，从而去掉一些可能会干扰结果的字符，比如说换行符 空格等等。所以说你为了代码降重稍微更改布局之类的根本没用。然后第二步就是创建一个窗口。这个窗口拥有固定的长度，从文本的开始滑动到结束。对于窗口内的每一个文本，我们都将其生成一个哈希值。那么对于计算机，或者是数据结构还没那么了解的小伙伴肯定就会问，那什么是哈希呢？哈希大家可以理解为一个函数，它会将给它的不同的信息都映射为不同独特的数字。那么哈希的特点就是输入相同的文字一定得到同样的哈希值，而输入不同的文字一般来说都会获得不同的结果。在这里咱们暂且不讨论哈希碰撞的问题，所以说哈希就可以代表一段文字，一段信息的唯一的特征。回到MOSS，那么对于窗口生成的这一大堆哈希值，MOSS会选择其中最小的几个哈希值，可能是5个，也有可能是更多，这就是分析相似度的最有名的方法：也就是最小哈希值，minhash。在最小哈希算法中，选择最小的哈希值作为文档的代表，这个值在一定程度上保留了文档的重要特征。即使文档内容发生微小变化，通常情况下，最小哈希值也会保持相对稳定。因此，这个最小哈希值可以作为文档的指纹，用于识别和比较文档之间的相似性。再得到两个文档的指纹后，MOSS会对于这两段代码进行Jaccard相似度计算，也就是两段代码指纹的交集除以并集，这样我们就可以得到一个两段代码百分比的相似度了，是不是非常简单。

为了让大家可以理解筛子算法，我也做了一个极简版文本相似度检测的网站，放在了我的个人网站上面：detect.haozheli.com，欢迎大家去玩。

那么在理解了筛子算法后，咱们就能解释绝大多数的问题了。
一：对于一些代码更改变量名有用吗？在这里我可以明确的告诉大家，单纯的更改变量名完全没用。这是因为更改变量名机会不会对最小哈希值产生什么影响，大家看这段例子也能看出来。我把所有的变量名都更改了名字，而MOSS还是可以精确的标记出可疑之处。
二：我更改代码函数的先后顺序有用吗？答案是，也没用。这是因为MOSS是通过滑动窗口然后在对窗口内信息生成哈希值，所以说仅仅更改代码的顺序也对于最小哈希值没用影响。看这个例子也能看出，我将A B两个函数进行了互换，MOSS也就能识别出来。

三：那么有没有什么方法能够使MOSS识别不出呢？那么还真有。因为MOSS不是一个基于人工智能的判断程序，所以说它并不能真正的理解一段代码。如果两段代码用不同的结构，或者是不同的文本实现了同样的逻辑，MOSS也是无法识别的。这个包括但不仅限于用Range-based for循环替代传统for循环，反写if 语句，用switch case或者是三目运算符替代if else语句，或者是将一个函数拆解为helper function。这些大量文本的变化都可以让MOSS失效。在这里我跟大家说一下，与其对于你的代码使用我提到的这些歪门邪道，不如好好理解代码逻辑并且自己去写。所以根本解决代码查重的方案，是理解知识后去自己写代码。